<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>超参数调优、批量归一化以及深度学习框架 | 叶子的技术碎碎念</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="叶子的技术碎碎念">
    
    <link rel="preload" href="/assets/css/0.styles.795fcb47.css" as="style"><link rel="preload" href="/assets/js/app.bd8004a5.js" as="script"><link rel="preload" href="/assets/js/7.d7dc3e09.js" as="script"><link rel="preload" href="/assets/js/2.d701f7d6.js" as="script"><link rel="preload" href="/assets/js/1.f54fd289.js" as="script"><link rel="preload" href="/assets/js/41.6d506318.js" as="script"><link rel="prefetch" href="/assets/js/10.79681363.js"><link rel="prefetch" href="/assets/js/11.29920769.js"><link rel="prefetch" href="/assets/js/14.b2cffd01.js"><link rel="prefetch" href="/assets/js/15.ba187924.js"><link rel="prefetch" href="/assets/js/16.1f560dd7.js"><link rel="prefetch" href="/assets/js/17.199dc857.js"><link rel="prefetch" href="/assets/js/18.b7c7ff02.js"><link rel="prefetch" href="/assets/js/19.04465c2e.js"><link rel="prefetch" href="/assets/js/20.4ba280e8.js"><link rel="prefetch" href="/assets/js/21.19e0a90d.js"><link rel="prefetch" href="/assets/js/22.79ef54ac.js"><link rel="prefetch" href="/assets/js/23.ba4ab7a0.js"><link rel="prefetch" href="/assets/js/24.afd714df.js"><link rel="prefetch" href="/assets/js/25.86016902.js"><link rel="prefetch" href="/assets/js/26.0a94d433.js"><link rel="prefetch" href="/assets/js/27.2768e2e4.js"><link rel="prefetch" href="/assets/js/28.c9fabea7.js"><link rel="prefetch" href="/assets/js/29.1e376621.js"><link rel="prefetch" href="/assets/js/3.bb090a50.js"><link rel="prefetch" href="/assets/js/30.129ca9e0.js"><link rel="prefetch" href="/assets/js/31.e32e2d81.js"><link rel="prefetch" href="/assets/js/32.79e0bedf.js"><link rel="prefetch" href="/assets/js/33.a9925ae6.js"><link rel="prefetch" href="/assets/js/34.b93dc917.js"><link rel="prefetch" href="/assets/js/35.2852e413.js"><link rel="prefetch" href="/assets/js/36.fb410a04.js"><link rel="prefetch" href="/assets/js/37.6bbe274a.js"><link rel="prefetch" href="/assets/js/38.1a1b315a.js"><link rel="prefetch" href="/assets/js/39.0e2e0de5.js"><link rel="prefetch" href="/assets/js/4.91310cca.js"><link rel="prefetch" href="/assets/js/40.7d41e87d.js"><link rel="prefetch" href="/assets/js/42.384ae83a.js"><link rel="prefetch" href="/assets/js/43.848ec979.js"><link rel="prefetch" href="/assets/js/44.6ad8702d.js"><link rel="prefetch" href="/assets/js/45.d9165949.js"><link rel="prefetch" href="/assets/js/46.7cf49e15.js"><link rel="prefetch" href="/assets/js/47.ab137e3c.js"><link rel="prefetch" href="/assets/js/48.23e89325.js"><link rel="prefetch" href="/assets/js/49.2e5727e6.js"><link rel="prefetch" href="/assets/js/5.ae9af707.js"><link rel="prefetch" href="/assets/js/50.e98bddca.js"><link rel="prefetch" href="/assets/js/51.a27effc2.js"><link rel="prefetch" href="/assets/js/52.ce7c3e96.js"><link rel="prefetch" href="/assets/js/53.959c70d1.js"><link rel="prefetch" href="/assets/js/6.ddc4768c.js"><link rel="prefetch" href="/assets/js/8.de91a9be.js"><link rel="prefetch" href="/assets/js/9.f7cbd4f5.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.65214fb5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.795fcb47.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>叶子的技术碎碎念</h3> <p class="description" data-v-59e6cb88>叶子的技术碎碎念</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">叶子的技术碎碎念</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="undefined"></i>
  关于我
</a></div><div class="nav-item"><a href="/AI/courses/DeepLearning Specialization/01 Neural Networks and Deep Learning/深度学习与神经网络入门.html" class="nav-link"><i class="undefined"></i>
  人工智能
</a></div><div class="nav-item"><a href="/Java/Map.html" class="nav-link"><i class="undefined"></i>
  Java
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      叶子的技术碎碎念
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/careywyr" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2831954919569245" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><!----> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>15</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>0</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="undefined"></i>
  关于我
</a></div><div class="nav-item"><a href="/AI/courses/DeepLearning Specialization/01 Neural Networks and Deep Learning/深度学习与神经网络入门.html" class="nav-link"><i class="undefined"></i>
  人工智能
</a></div><div class="nav-item"><a href="/Java/Map.html" class="nav-link"><i class="undefined"></i>
  Java
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      叶子的技术碎碎念
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/careywyr" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2831954919569245" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Coursera深度学习专项课程</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AI/courses/DeepLearning Specialization/01 Neural Networks and Deep Learning/深度学习与神经网络入门.html" class="sidebar-link">深度学习与神经网络入门</a></li><li><a href="/AI/courses/DeepLearning Specialization/02 Improving Deep Neural Networks- Hyperparameter Tuning, Regularization and Optimization/Week1-blog.html" class="sidebar-link">深度学习实践基础</a></li><li><a href="/AI/courses/DeepLearning Specialization/02 Improving Deep Neural Networks- Hyperparameter Tuning, Regularization and Optimization/Week2-blog.html" class="sidebar-link">深度学习的优化算法</a></li><li><a href="/AI/courses/DeepLearning Specialization/02 Improving Deep Neural Networks- Hyperparameter Tuning, Regularization and Optimization/Week3-blog.html" class="active sidebar-link">超参数调优、批量归一化以及深度学习框架</a></li><li><a href="/AI/courses/DeepLearning Specialization/03 Structuring Machine Learning Projects/BLOG.html" class="sidebar-link">机器学习策略详解</a></li><li><a href="/AI/courses/DeepLearning Specialization/05 Sequence Models/Week1 blog.html" class="sidebar-link">循环神经网络介绍</a></li><li><a href="/AI/courses/DeepLearning Specialization/05 Sequence Models/Week2 blog.html" class="sidebar-link">浅谈 Word Embeddings</a></li><li><a href="/AI/courses/DeepLearning Specialization/05 Sequence Models/Week3 blog.html" class="sidebar-link">解密序列到序列模型：从机器翻译到语音识别</a></li><li><a href="/AI/courses/DeepLearning Specialization/05 Sequence Models/Week4 blog.html" class="sidebar-link">Transformer 网络解读</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>机器学习基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AI/机器学习/关联规则挖掘与Apriori算法.html" class="sidebar-link">关联规则挖掘与Apriori算法</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>超参数调优、批量归一化以及深度学习框架</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page" style="padding-right:0;"><section style="display:;"><div class="page-title"><h1 class="title">超参数调优、批量归一化以及深度学习框架</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>叶子</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>2023/7/12</span></i> <!----> <!----></div></div> <div class="theme-reco-content content__default"><p>本篇博客的内容主要是超参数调优，批量归一化以及常见的深度学习框架，也是深度学习专项课程第二门课的最后一周课程内容，Let's Go!</p> <h2 id="超参数调优"><a href="#超参数调优" class="header-anchor">#</a> 超参数调优</h2> <p>在深度学习中,超参数调优是一个非常关键的过程。合适的超参数设置将直接影响深度学习模型的性能。本节将详细探讨深度学习中超参数调优的重要性、主要影响模型性能的超参数以及超参数选择的方法与策略。</p> <h3 id="超参数调优的重要性"><a href="#超参数调优的重要性" class="header-anchor">#</a> 超参数调优的重要性</h3> <p>超参数调优对深度学习模型性能有决定性的影响。合理的超参数设置将大大提高模型的训练效率、泛化能力以及测试效果。反之,不当的超参数选择也可能导致模型训练缓慢、无法有效学习、过拟合等问题。</p> <p>具体来说,超参数调优的重要性体现在以下几个方面:</p> <ol><li>超参数直接影响模型复杂度,从而影响模型的学习能力。合适复杂度的模型既可以充分学习数据的模式,也可以避免过拟合。</li> <li>不同的超参数会影响模型训练的速度。选择合理的批量大小、学习率等可以大大加速模型的训练。</li> <li>超参数设置会影响模型收敛性。合理的超参数可以帮助模型更快更稳定地达到收敛状态。</li> <li>超参数选择与正则化技术息息相关,将直接影响模型的泛化能力。</li> <li>超参数将影响模型优化过程。不同的超参数组合将导致训练过程中的损失函数下降动态完全不同。</li> <li>在深度学习领域,往往很难直接从理论上导出最优的超参数设置,只能依靠经验与实验结果。因此超参数调优更是一个实验性质的过程。</li></ol> <p>综上,超参数调优是深度学习中一个非常关键的实验性过程,它直接关乎到模型的最终性能。因此,我们必须通过不断的试验来寻找最优的超参数组合,这需要投入大量的时间和计算资源。但超参数调优的回报也十分可观,它可以大幅提升深度学习模型的效果。</p> <h3 id="主要影响模型性能的超参数"><a href="#主要影响模型性能的超参数" class="header-anchor">#</a> 主要影响模型性能的超参数</h3> <p>深度学习模型中包含了大量的超参数,但通常来说,并不是所有的超参数都会对模型性能产生很大影响。主要影响模型效果的关键超参数包括:</p> <p><strong>1. 学习率</strong>
学习率是深度学习模型训练中最重要的超参数之一。学习率决定了Gradient Descent优化算法在参数空间中移动的幅度。太小的学习率将导致训练缓慢甚至停滞;太大的学习率将导致训练动态不稳定。学习率需要设置在一个合理的范围内,通常通过试验找到最佳值。</p> <p><strong>2. 批量大小</strong>
批量大小决定每次前向和反向传播时抓取的样本数量。批量大小较小将导致噪声较大,但可以更频繁地更新参数;批量大小较大的情况下，单个批次的梯度估计的方差较小，这有助于网络更稳定地训练，但这也可能使训练过程需要更多的计算资源和时间。一般来说,批量大小设置为16、32、64、128等对大多数模型来说是合理的。</p> <p><strong>3. 权重初始化方法</strong>
不同的权重初始化方法会影响深度学习模型的训练速度与效果。常见的初始化方法包括随机初始化、Xavier初始化等。合理的初始化可以加速模型的收敛速度,并有助于避免梯度消失/爆炸问题。</p> <p><strong>4. 优化器的选择</strong>
深度学习中常用的优化器包括SGD、Momentum、RMSProp、Adam等。不同的优化器将导致训练过程中的损失函数下降动态差异很大。一般来说,SGD适用于简单的模型,而Adam等自适应学习率的优化器对复杂的深度模型更为有效。</p> <p><strong>5. 正则化强度</strong>
正则化技术(L1正则化、L2正则化、Dropout等)用来抑制过拟合,防止模型变得过于复杂。正则化强度决定了这种抑制的力度。正则化强度过小将导致过拟合,过大将导致欠拟合。一般需多次试验找到最佳正则化强度。</p> <p><strong>6. 网络层数与宽度</strong>
网络宽度指每层中的隐层单元数,网络层数指模型的层数。这两个超参数共同决定了网络的表示能力和复杂度。设置适当的网络宽度和层数能够容纳数据中的模式,防止欠拟合。</p> <p><strong>7. 学习率衰减策略</strong>
学习率衰减指随着训练迭代次数增加,逐渐减小模型的学习率。常见的学习率衰减策略包括步阶衰减、指数衰减等。合理的衰减策略可以加速模型收敛,并提升测试效果。</p> <p>上述七个超参数可以认为是深度学习模型性能的关键影响因素。但实际上,不同的模型结构以及数据集的不同,会导致一些其他超参数也变得非常重要。因此,我们需要根据具体情况,选择对目标模型和数据集影响最大的几个超参数作为调优的重点。</p> <h3 id="如何选择超参数的值"><a href="#如何选择超参数的值" class="header-anchor">#</a> 如何选择超参数的值</h3> <p>超参数的选择通常需要基于实验和经验。以下是一些常用的策略：</p> <ol><li><strong>网格搜索（Grid Search）</strong>：在这种方法中，我们会为每个超参数设定一个值的范围，然后尝试所有可能的超参数组合。这种方法可以找到最优的超参数组合，但计算成本很高，特别是当超参数数量很多时。</li> <li><strong>随机搜索（Random Search）</strong>：在这种方法中，我们会为每个超参数设定一个值的范围，然后随机选择超参数的值。这种方法的计算成本较低，当超参数的数量较多时，网格搜索可能只能探索到超参数空间的一小部分。而随机取样可以更有效地探索整个超参数空间，因此有更大的机会找到优秀的超参数设定。</li></ol> <p>一旦我们找到了一个表现良好的超参数设定，我们可以在这个设定附近进行更精细的搜索，这就是所谓的区域定位的抽样方案。具体来说，我们可以为每个超参数设定一个较小的范围，然后在这个范围内进行随机取样或网格搜索。这样可以在较少的试验次数中找到更好的超参数设定。</p> <p>在选择超参数时，使用适当的刻度很重要。例如，学习率通常在0.0001到1之间，但这并不意味着我们应该在这个范围内均匀地选择学习率。因为学习率对模型性能的影响是对数刻度的，所以我们应该在对数刻度上选择学习率。一般来说，我们会选择一个初始的学习率，然后在每次迭代中，我们会乘以一个小于1的因子（例如0.9或0.99）。这样，学习率会逐渐减小，使得模型在初期可以快速学习，而在后期则可以更精细地调整权重。</p> <h3 id="实践中的超参数调优"><a href="#实践中的超参数调优" class="header-anchor">#</a> 实践中的超参数调优</h3> <p>超参数的选择对深度学习的结果有显著影响。这些选择在不同领域中可能有所不同，但也存在一些共通性。一些已经在一个领域中被验证过的超参数配置可能也适用于其他领域。这种跨领域借鉴的策略已成为深度学习领域的一种发展趋势。
在实际使用中，一种被定义为最优的超参数设置可能随着数据集的改变、硬件设施的更新等因素变为不再优秀。因此，建议至少每隔几个月重新检测或重新评估一次你认为最优的超参数。</p> <p>在实践中有两种超参数探寻的模式：</p> <ul><li><strong>熊猫模式（Panda mode）</strong>：该模式更像一个精心照料单一模型的过程，尤其适合在资源受限的情况下使用。你可能只有足够的资源训练一个或者非常少量的模型，这时你需要紧盯模型的学习曲线，并不断调整学习率或其他超参数来优化模型的表现。</li> <li><strong>鱼子酱模式（Caviar mode）</strong>：该模式适用于资源充足的情况，你可以同时并行训练很多模型，尝试不同的超参数设置，然后从中选择最终结果最好的超参数。
<img src="https://leafw-blog-pic.oss-cn-hangzhou.aliyuncs.com/1689174826054.png" alt="">
熊猫模式和鱼子酱模式的选择取决于你的计算资源。如果你有足够的计算机来并行训练很多模型，那么采用鱼子酱模式，尝试大量不同的超参数，看看结果如何。然而在一些应用领域，例如在线广告设置、计算机视觉识别等领域，可能需要处理海量的数据和大量的模型，这时，采用熊猫模式更为合适。</li></ul> <p>虽然一些超参数设置在不同的任务和领域中可能有所共通，但也要注意到，有些超参数可能具有更强的任务依赖性，如何平衡这种普适性和特异性，需要依赖实际的问题和经验。</p> <h2 id="批量归一化"><a href="#批量归一化" class="header-anchor">#</a> 批量归一化</h2> <p>批量归一化是深度学习中提出的一种重要技术,它可以加速网络训练并提高模型的泛化能力。本节将全面介绍批量归一化的工作机制、效果以及实际应用中的注意事项。</p> <h3 id="批量归一化的工作原理"><a href="#批量归一化的工作原理" class="header-anchor">#</a> 批量归一化的工作原理</h3> <p>为了加深理解,下面将从数学原理详细推导批量归一化的过程:</p> <p>假设一个 mini-batch 中有 m 个样本,网络某层的输出为 <mjx-container jax="CHTML" class="MathJax"><mjx-math class="MJX-TEX"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="x"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mn size="s" class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn></mjx-script></mjx-msub><mjx-mo class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-msub space="2"><mjx-mi noIC="true" class="mjx-i"><mjx-c c="x"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mn size="s" class="mjx-n"><mjx-c c="2"></mjx-c></mjx-mn></mjx-script></mjx-msub><mjx-mo class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-mo space="2" class="mjx-n"><mjx-c c="22EF"></mjx-c></mjx-mo><mjx-mo space="2" class="mjx-n"><mjx-c c=","></mjx-c></mjx-mo><mjx-msub space="2"><mjx-mi noIC="true" class="mjx-i"><mjx-c c="x"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>,我们先计算这批数据的均值与方差:</p> <p></p><p><mjx-container jax="CHTML" display="true" class="MathJax"><mjx-math display="true" class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="3BC"></mjx-c></mjx-mi><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mfrac space="4"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mi class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-munderover space="2"><mjx-over style="padding-bottom:0.192em;padding-left:0.412em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-over><mjx-box><mjx-munder><mjx-row><mjx-base><mjx-mo class="mjx-lop"><mjx-c c="2211"></mjx-c></mjx-mo></mjx-base></mjx-row><mjx-row><mjx-under style="padding-top:0.167em;padding-left:0.148em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn></mjx-TeXAtom></mjx-under></mjx-row></mjx-munder></mjx-box></mjx-munderover><mjx-msub space="2"><mjx-mi noIC="true" class="mjx-i"><mjx-c c="x"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container></p> <p><mjx-container jax="CHTML" display="true" class="MathJax"><mjx-math display="true" class="MJX-TEX"><mjx-msup><mjx-mi class="mjx-i"><mjx-c c="3C3"></mjx-c></mjx-mi><mjx-script style="vertical-align:0.413em;"><mjx-mn size="s" class="mjx-n"><mjx-c c="2"></mjx-c></mjx-mn></mjx-script></mjx-msup><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mfrac space="4"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mi class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-munderover space="2"><mjx-over style="padding-bottom:0.192em;padding-left:0.412em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-over><mjx-box><mjx-munder><mjx-row><mjx-base><mjx-mo class="mjx-lop"><mjx-c c="2211"></mjx-c></mjx-mo></mjx-base></mjx-row><mjx-row><mjx-under style="padding-top:0.167em;padding-left:0.148em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn></mjx-TeXAtom></mjx-under></mjx-row></mjx-munder></mjx-box></mjx-munderover><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="x"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo space="3" class="mjx-n"><mjx-c c="2212"></mjx-c></mjx-mo><mjx-mi space="3" class="mjx-i"><mjx-c c="3BC"></mjx-c></mjx-mi><mjx-msup><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-script style="vertical-align:0.413em;"><mjx-mn size="s" class="mjx-n"><mjx-c c="2"></mjx-c></mjx-mn></mjx-script></mjx-msup></mjx-math></mjx-container></p><p></p> <p>然后用这两个统计量来进行归一化:
</p><p><mjx-container jax="CHTML" display="true" class="MathJax"><mjx-math display="true" class="MJX-TEX"><mjx-msub><mjx-TeXAtom><mjx-mover><mjx-over style="padding-bottom:0.06em;padding-left:0.064em;margin-bottom:-0.531em;"><mjx-mo class="mjx-n"><mjx-c c="^"></mjx-c></mjx-mo></mjx-over><mjx-base><mjx-mi class="mjx-i"><mjx-c c="x"></mjx-c></mjx-mi></mjx-base></mjx-mover></mjx-TeXAtom><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mfrac space="4"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="x"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo space="3" class="mjx-n"><mjx-c c="2212"></mjx-c></mjx-mo><mjx-mi space="3" class="mjx-i"><mjx-c c="3BC"></mjx-c></mjx-mi></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msqrt><mjx-sqrt><mjx-surd><mjx-mo class="mjx-sop"><mjx-c c="221A"></mjx-c></mjx-mo></mjx-surd><mjx-box style="padding-top:0.105em;"><mjx-msup><mjx-mi class="mjx-i"><mjx-c c="3C3"></mjx-c></mjx-mi><mjx-script style="vertical-align:0.363em;"><mjx-mn size="s" class="mjx-n"><mjx-c c="2"></mjx-c></mjx-mn></mjx-script></mjx-msup><mjx-mo space="3" class="mjx-n"><mjx-c c="+"></mjx-c></mjx-mo><mjx-mi space="3" class="mjx-i"><mjx-c c="3F5"></mjx-c></mjx-mi></mjx-box></mjx-sqrt></mjx-msqrt></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-math></mjx-container></p><p></p> <p>这里 <mjx-container jax="CHTML" class="MathJax"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="3F5"></mjx-c></mjx-mi></mjx-math></mjx-container> 是为了数值稳定性加上的一个非常小的数。</p> <p>到这里,数据已经被归一化为均值为0,方差为1的分布。但这会改变原始数据的表示范围。因此,我们需要一个逆变换来恢复数据的表示能力:
</p><p><mjx-container jax="CHTML" display="true" class="MathJax"><mjx-math display="true" class="MJX-TEX"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="y"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mi space="4" class="mjx-i"><mjx-c c="3B3"></mjx-c></mjx-mi><mjx-msub><mjx-TeXAtom><mjx-mover><mjx-over style="padding-bottom:0.06em;padding-left:0.064em;margin-bottom:-0.531em;"><mjx-mo class="mjx-n"><mjx-c c="^"></mjx-c></mjx-mo></mjx-over><mjx-base><mjx-mi class="mjx-i"><mjx-c c="x"></mjx-c></mjx-mi></mjx-base></mjx-mover></mjx-TeXAtom><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo class="mjx-n"><mjx-c c="+"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="3B2"></mjx-c></mjx-mi></mjx-math></mjx-container></p>
这里 <mjx-container jax="CHTML" class="MathJax"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="3B3"></mjx-c></mjx-mi></mjx-math></mjx-container> 和 <mjx-container jax="CHTML" class="MathJax"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="3B2"></mjx-c></mjx-mi></mjx-math></mjx-container> 是可学习的参数,用来恢复数据原始的均值与方差。这样一来,我们就得到了保持表达能力的归一化数据。<p></p> <p>上述是批量归一化在训练时使用的方法。在模型测试阶段,由于无法获得批量统计量,所以利用移动平均的方法,使用训练期间均值和方差的指数滑动平均来进行估计。</p> <h3 id="批量归一化为什么有效"><a href="#批量归一化为什么有效" class="header-anchor">#</a> 批量归一化为什么有效</h3> <p>批量归一化之所以对深度神经网络有效,主要有以下原因:</p> <ol><li>它可以减少模型对参数初始值的敏感度。网络中的权重参数初始化非常重要,但随机初始化难以确认最佳值。BN通过归一化输入,使网络对参数初始值不那么敏感。</li> <li>它可以在一定程度上起到正则化的效果。利用批量统计产生的随机性有点类似于随机丢弃的效果,可以稍微抑制过拟合。</li> <li>它可以显著加快网络的训练速度。归一化保证了各层分布的一致性,这样每个训练批量就能以更大的学习率训练。</li> <li>BN还可以一定程度上减轻梯度消失问题。因为每层输入值都被重新归一化为合理范围。</li> <li>最后,BN允许使用较小的权重衰减来防止过拟合,从而进一步提升性能。</li></ol> <p>综上,批量归一化强大之处在于它同时具备加速训练、提升泛化能力、减轻梯度消失和正则化等多重功效。这些作用最终集成,使其成为提升深度神经网络性能的关键手段之一。</p> <h3 id="测试阶段的批量归一化"><a href="#测试阶段的批量归一化" class="header-anchor">#</a> 测试阶段的批量归一化</h3> <p>在训练时，我们使用一个批量的数据来计算均值和方差。但在测试时，我们通常一次只处理一个样本，这时就无法计算出均值和方差。为了解决这个问题，我们通常会在训练过程中保留一个运行时的均值和方差，然后在测试时使用这些运行时的统计量。</p> <p>具体来说，我们会使用指数加权平均的方法来计算运行时的均值和方差：</p> <p></p><p><mjx-container jax="CHTML" display="true" class="MathJax"><mjx-math display="true" class="MJX-TEX"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="3BC"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="u"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="g"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msub><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mi space="4" class="mjx-i"><mjx-c c="3B1"></mjx-c></mjx-mi><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="3BC"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="u"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="g"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msub><mjx-mo space="3" class="mjx-n"><mjx-c c="+"></mjx-c></mjx-mo><mjx-mo space="3" class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn><mjx-mo space="3" class="mjx-n"><mjx-c c="2212"></mjx-c></mjx-mo><mjx-mi space="3" class="mjx-i"><mjx-c c="3B1"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="3BC"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="b"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="a"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="c"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="h"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msub></mjx-math></mjx-container></p> <p><mjx-container jax="CHTML" display="true" class="MathJax"><mjx-math display="true" class="MJX-TEX"><mjx-msubsup><mjx-mi noIC="true" class="mjx-i"><mjx-c c="3C3"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.247em;"><mjx-mn size="s" class="mjx-n"><mjx-c c="2"></mjx-c></mjx-mn><mjx-spacer style="margin-top:0.193em;"></mjx-spacer><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="r"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="u"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="g"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msubsup><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mi space="4" class="mjx-i"><mjx-c c="3B1"></mjx-c></mjx-mi><mjx-msup><mjx-mi class="mjx-i"><mjx-c c="3C3"></mjx-c></mjx-mi><mjx-script style="vertical-align:0.413em;"><mjx-mn size="s" class="mjx-n"><mjx-c c="2"></mjx-c></mjx-mn></mjx-script></mjx-msup><mjx-mo space="3" class="mjx-n"><mjx-c c="+"></mjx-c></mjx-mo><mjx-mo space="3" class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn><mjx-mo space="3" class="mjx-n"><mjx-c c="2212"></mjx-c></mjx-mo><mjx-mi space="3" class="mjx-i"><mjx-c c="3B1"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-msubsup><mjx-mi noIC="true" class="mjx-i"><mjx-c c="3C3"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.258em;"><mjx-mn size="s" class="mjx-n"><mjx-c c="2"></mjx-c></mjx-mn><mjx-spacer style="margin-top:0.18em;"></mjx-spacer><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="b"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="a"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="c"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="h"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msubsup></mjx-math></mjx-container></p><p></p> <p>其中，α 是一个接近1的小数（例如0.9或0.99），<mjx-container jax="CHTML" class="MathJax"><mjx-math class="MJX-TEX"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="3BC"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="b"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="a"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="c"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="h"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msub></mjx-math></mjx-container>和 <mjx-container jax="CHTML" class="MathJax"><mjx-math class="MJX-TEX"><mjx-msubsup><mjx-mi noIC="true" class="mjx-i"><mjx-c c="3C3"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.308em;"><mjx-mn size="s" class="mjx-n"><mjx-c c="2"></mjx-c></mjx-mn><mjx-spacer style="margin-top:0.18em;"></mjx-spacer><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="b"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="a"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="t"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="c"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="h"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msubsup></mjx-math></mjx-container>​ 是当前批量的均值和方差。通过这种方式，我们可以得到一个对整个训练数据分布的估计，然后在测试时使用这个估计来进行归一化。</p> <h3 id="批量归一化的应用建议"><a href="#批量归一化的应用建议" class="header-anchor">#</a> 批量归一化的应用建议</h3> <p>在实际使用批量归一化时,以下几点建议可以帮助发挥BN的最大功效:</p> <ol><li>BN层通常放在全连接层或卷积层之后,激活函数之前。尽量不要把BN层置于网络的开始或结束。然而，要注意的是，对于ReLU这类非饱和性激活函数，将BN放在激活函数之后也是可行的，实践中这两种配置的效果往往都是可以接受的。</li> <li>可以同时使用BN和Dropout等其他正则化方法,因为BN归一化输入分布,Dropout随机扰动表示。两者起到正交的正则化作用，要注意的是，因为BN的归一化效果，Dropout可能不会像在普通网络中那样有效，所以在使用两者的结合时可能需要进行额外的调整。</li> <li>当数据集较小时,批量统计容易受单个batch的噪声影响较大。可以采用更大的batch size或利用持续集成的批量统计数据。</li> <li>BN参数的更新应放在网络参数更新之后,先计算必要的统计数据,再更新参数。</li> <li>可以将BN过程封装为一个函数或计算模块,这样可以方便地在网络中任意位置调用。</li> <li>对于小batch size,学习率要相应降低,因为BN的正则效应会弱一些。</li></ol> <h2 id="多类别分类"><a href="#多类别分类" class="header-anchor">#</a> 多类别分类</h2> <p>对于多类别分类问题,我们通常使用softmax回归模型。本节将详细介绍softmax回归的概念、原理、实现及应用技巧。</p> <h3 id="softmax回归概述"><a href="#softmax回归概述" class="header-anchor">#</a> softmax回归概述</h3> <p>softmax回归是一种广义的逻辑回归,可以看作多分类问题的对数线性回归。它通过引入softmax函数,将网络输出值转换为各分类的概率,从而实现多类别分类。相比 One-vs-All 方法,softmax回归无需训练多个二分类器,直接可以得到各类的概率,因此更加简洁有效。softmax回归已成为多类分类问题的标准解决方案之一。
<img src="https://www.tensorflow.org/images/softmax-regression-scalargraph.png" alt=""></p> <h3 id="softmax回归原理"><a href="#softmax回归原理" class="header-anchor">#</a> softmax回归原理</h3> <p>假设我们有一个包含m个样本的数据集,每个样本x属于n个类别之一。我们定义一个线性模型,它对每个样本输出一个包含n个元素的向量z,每个元素代表对应类别的“分数”。我们的目标是训练这个线性模型,使得对于样本x,模型输出的对应真实类别的分数最高。</p> <p>为此,我们先通过softmax函数将z归一化为概率分布p:</p> <p></p><p><mjx-container jax="CHTML" display="true" class="MathJax"><mjx-math display="true" class="MJX-TEX"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="p"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mfrac space="4"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-msup><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-script style="vertical-align:0.363em;"><mjx-TeXAtom size="s"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="z"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-TeXAtom></mjx-script></mjx-msup></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mrow><mjx-munderover limits="false"><mjx-mo class="mjx-sop"><mjx-c c="2211"></mjx-c></mjx-mo><mjx-script style="vertical-align:-0.285em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-spacer style="margin-top:0.284em;"></mjx-spacer><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="j"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn></mjx-TeXAtom></mjx-script></mjx-munderover><mjx-msup space="2"><mjx-mi class="mjx-i"><mjx-c c="e"></mjx-c></mjx-mi><mjx-script style="vertical-align:0.363em;"><mjx-TeXAtom size="s"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="z"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="j"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-TeXAtom></mjx-script></mjx-msup></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-math></mjx-container></p><p></p> <p>其中 <mjx-container jax="CHTML" class="MathJax"><mjx-math class="MJX-TEX"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="p"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container> 是样本属于第i类的预测概率,<mjx-container jax="CHTML" class="MathJax"><mjx-math class="MJX-TEX"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="z"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container>是线性模型给出的原始分数。</p> <p>然后我们使用交叉熵损失函数衡量预测与真实标签之间的距离:</p> <p></p><p><mjx-container jax="CHTML" display="true" class="MathJax"><mjx-math display="true" class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="J"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="3B8"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mo space="4" class="mjx-n"><mjx-c c="2212"></mjx-c></mjx-mo><mjx-munderover space="2"><mjx-over style="padding-bottom:0.192em;padding-left:0.412em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="m"></mjx-c></mjx-mi></mjx-over><mjx-box><mjx-munder><mjx-row><mjx-base><mjx-mo class="mjx-lop"><mjx-c c="2211"></mjx-c></mjx-mo></mjx-base></mjx-row><mjx-row><mjx-under style="padding-top:0.167em;padding-left:0.148em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn></mjx-TeXAtom></mjx-under></mjx-row></mjx-munder></mjx-box></mjx-munderover><mjx-munderover space="2"><mjx-over style="padding-bottom:0.192em;padding-left:0.51em;"><mjx-mi size="s" class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi></mjx-over><mjx-box><mjx-munder><mjx-row><mjx-base><mjx-mo class="mjx-lop"><mjx-c c="2211"></mjx-c></mjx-mo></mjx-base></mjx-row><mjx-row><mjx-under style="padding-top:0.167em;padding-left:0.124em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="j"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn></mjx-TeXAtom></mjx-under></mjx-row></mjx-munder></mjx-box></mjx-munderover><mjx-msub space="2"><mjx-mi noIC="true" class="mjx-i"><mjx-c c="y"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="j"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msub><mjx-mi space="2" class="mjx-n"><mjx-c c="l"></mjx-c><mjx-c c="o"></mjx-c><mjx-c c="g"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="2061"></mjx-c></mjx-mo><mjx-mrow><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="p"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="j"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msub><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo></mjx-mrow></mjx-math></mjx-container></p><p></p> <p>这里,如果样本i属于类j,则<mjx-container jax="CHTML" class="MathJax"><mjx-math class="MJX-TEX"><mjx-msub><mjx-mi noIC="true" class="mjx-i"><mjx-c c="y"></mjx-c></mjx-mi><mjx-script style="vertical-align:-0.15em;"><mjx-TeXAtom size="s"><mjx-mi class="mjx-i"><mjx-c c="i"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c c="j"></mjx-c></mjx-mi></mjx-TeXAtom></mjx-script></mjx-msub><mjx-mo space="4" class="mjx-n"><mjx-c c="="></mjx-c></mjx-mo><mjx-mn space="4" class="mjx-n"><mjx-c c="1"></mjx-c></mjx-mn></mjx-math></mjx-container>,其他为0。</p> <p>最终,通过梯度下降算法优化损失函数,可以得到训练好的softmax回归模型。对新样本,我们计算它的分数向量z,并用softmax转换为概率,选择概率最大的类别作为预测结果。</p> <h2 id="softmax回归实现"><a href="#softmax回归实现" class="header-anchor">#</a> softmax回归实现</h2> <p>利用Python和一些机器学习库(如TensorFlow),我们可以简单实现softmax回归。主要步骤包括:</p> <ol><li>构建计算图,输入特征x,输出分数向量z。这里z通常是两个全连接层,加上非线性激活。</li> <li>对z应用softmax函数获得概率p。 Softmax计算可以用tf.nn.softmax()实现。</li> <li>定义交叉熵损失函数,自动计算所有样本的loss。可以用tf.nn.sparse_softmax_cross_entropy_with_logits()。</li> <li>设定优化器,迭代训练更新参数,最小化损失函数。常用的优化器有SGD、Adam等。</li> <li>得到训练好的模型后,对新样本预测类别时,先经模型得到z,再softmax转换为概率p,选择概率最大的类别。</li></ol> <h3 id="softmax回归应用技巧"><a href="#softmax回归应用技巧" class="header-anchor">#</a> softmax回归应用技巧</h3> <p>softmax回归是一个简单有效的多类分类模型,以下技巧可以帮助提升其性能:</p> <ol><li>对分类数量较多的问题,可以采用层次softmax,先进行粗分类,再细分类。</li> <li>通过关注易错类别加大其损失权重等手段,可以平衡各类别的识别效果。</li> <li>联合使用softmax回归和其他评分模型,进行集成学习可以得到更好的分类性能。</li> <li>通过可视化softmax模型的分类决策边界,可以直观判断分类的合理性,采取相应手段改进模型。</li> <li>softmax模型可以预训练语义特征表达,然后作为下游模型的基础,实现迁移学习。</li> <li>注意最后一层要增加批量归一化层,可以避免梯度数值不稳定,起到正则化作用。</li> <li>预测结果的置信度也很有用,可以用来过滤低置信度的预测或请求人工审核。</li></ol> <p>综上,softmax回归是一个既简单又有效的多分类模型,值得我们深入研究与应用,以解决更多实际问题。</p> <h2 id="深度学习框架简介"><a href="#深度学习框架简介" class="header-anchor">#</a> 深度学习框架简介</h2> <p>我们使用Python和NumPy可以从头开始实现深度学习的算法，理解算法的工作原理。但如果要实现复杂的深度学习模型，如卷积神经网络（CNN）和循环神经网络（RNN），都会非常困难。实际上，在深度学习领域，有许多优秀的开源框架，它们为研究人员和工程师提供了构建、训练和部署神经网络模型的工具。比如TensorFlow， PyTorch等。
那么如何选择深度学习的框架，以下几点很重要：</p> <ul><li><strong>编程的简便性</strong>：对神经网络的开发和迭代改善，以及在生产环境中的部署都有好处。</li> <li><strong>运行速度</strong>：在大数据集上进行训练时，某些框架能让你更高效地运行和训练神经网络。</li> <li><strong>真正的开源性</strong>：一个真正的开源框架不仅需要开放源码，还需要良好的管理。你应该更信任那些长期会保持开源，而不是被单一公司所掌控的框架。
当然，有时候框架的选择还要取决于你的编程语言偏好和你构建应用的类型。选择合适的框架可以让你在开发机器学习应用时更加高效。</li></ul> <p>以上就是本次博客的全部内容，希望能对你有所帮助。欢迎大家提出意见哦。</p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/AI/courses/DeepLearning Specialization/02 Improving Deep Neural Networks- Hyperparameter Tuning, Regularization and Optimization/Week2-blog.html" class="prev">
          深度学习的优化算法
        </a></span> <span class="next"><a href="/AI/courses/DeepLearning Specialization/03 Structuring Machine Learning Projects/BLOG.html">
          机器学习策略详解
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:0;" data-v-b57cc07c data-v-7dd95ae2></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.bd8004a5.js" defer></script><script src="/assets/js/7.d7dc3e09.js" defer></script><script src="/assets/js/2.d701f7d6.js" defer></script><script src="/assets/js/1.f54fd289.js" defer></script><script src="/assets/js/41.6d506318.js" defer></script>
  </body>
</html>
